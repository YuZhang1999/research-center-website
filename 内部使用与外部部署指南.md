# 课题组网站内部使用与外部部署指南

## 项目现状分析

您的课题组网站已经完成了以下工作：
1. **前端项目**：使用React + Ant Design构建，包含12个主要页面
2. **后端框架**：Node.js + Express框架已搭建
3. **构建文件**：前端已成功构建，生成`frontend/build`目录
4. **启动脚本**：提供了Windows批处理脚本`启动网站/启动网站.bat`
5. **项目文档**：完整的README和启动说明

## 第一部分：内部使用指南

### 1.1 当前内部使用方式

#### 方法一：使用启动脚本（推荐）
1. 双击运行 `启动网站/启动网站.bat`
2. 脚本会自动检测Python环境
3. 启动本地HTTP服务器（端口8080）
4. 自动打开浏览器访问 `http://localhost:8080`

#### 方法二：开发模式启动
```bash
# 1. 安装依赖（如果未安装）
npm run install:all

# 2. 启动前端开发服务器
npm run start:frontend
# 访问 http://localhost:3000

# 3. 启动后端开发服务器（可选）
npm run start:backend
# API服务运行在 http://localhost:3001
```

#### 方法三：使用构建文件
```bash
# 进入构建目录
cd frontend/build

# 使用Python启动服务器
python -m http.server 8080

# 或使用Node.js的serve工具
npx serve -s . -p 8080
```

### 1.2 内部网络访问配置

#### 局域网内访问
1. 确保服务器运行在局域网可访问的IP上：
   ```bash
   # 使用特定IP和端口
   python -m http.server 8080 --bind 0.0.0.0
   ```

2. 获取本机IP地址：
   - Windows: `ipconfig`
   - Linux/Mac: `ifconfig` 或 `ip addr`

3. 其他设备访问：
   - 在浏览器输入：`http://[服务器IP]:8080`
   - 例如：`http://192.168.1.100:8080`

#### 配置防火墙
```bash
# Windows防火墙允许端口8080
netsh advfirewall firewall add rule name="课题组网站" dir=in action=allow protocol=TCP localport=8080

# Linux防火墙
sudo ufw allow 8080/tcp
```

### 1.3 内部使用优化建议

#### 内容管理
1. **替换示例数据**：
   - 更新`frontend/src/pages/`各页面中的示例内容
   - 替换占位图片为实际图片
   - 更新团队成员、科研成果等真实信息

2. **配置环境变量**：
   ```bash
   # frontend/.env 示例
   REACT_APP_API_URL=http://localhost:3001
   REACT_APP_SITE_NAME=云南省工业废水光催化处理工程技术研究中心
   ```

#### 功能完善
1. **后端API开发**：
   - 完善`backend/src/`中的控制器和路由
   - 配置数据库连接（MySQL/PostgreSQL）
   - 实现用户认证、数据管理等功能

2. **内部功能模块**：
   - 仪器预约系统
   - 文档共享平台
   - 内部通讯工具

## 第二部分：外部部署方案

### 2.1 部署前准备

#### 技术选型建议
| 方案 | 适合场景 | 成本 | 复杂度 |
|------|----------|------|--------|
| 云服务器 + Nginx | 完全控制，适合长期运行 | 中等 | 中等 |
| 静态网站托管 | 纯前端展示，无需后端 | 低 | 低 |
| Docker容器化 | 环境隔离，易于迁移 | 中等 | 中等 |
| 平台即服务 | 快速部署，无需运维 | 中等 | 低 |

#### 域名准备
1. **注册域名**：
   - 推荐：`.cn`、`.com.cn`、`.ac.cn`
   - 示例：`yunnan-photocatalysis.cn`
   
2. **备案要求**：
   - 国内服务器必须进行ICP备案
   - 备案周期：约20个工作日

### 2.2 云服务器部署方案

#### 方案一：Linux服务器 + Nginx

**步骤1：服务器准备**
```bash
# 1. 购买云服务器（推荐配置）
# - CPU: 2核
# - 内存: 4GB
# - 系统: Ubuntu 22.04 LTS
# - 带宽: 5Mbps

# 2. 连接服务器
ssh root@服务器IP

# 3. 安装必要软件
apt update && apt upgrade -y
apt install nginx nodejs npm python3-certbot-nginx -y
```

**步骤2：部署前端**
```bash
# 1. 上传构建文件
scp -r frontend/build/* root@服务器IP:/var/www/课题组网站

# 2. 配置Nginx
# 创建配置文件 /etc/nginx/sites-available/research-center
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;
    
    root /var/www/课题组网站;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 静态文件缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

**步骤3：配置SSL证书**
```bash
# 使用Let's Encrypt免费证书
certbot --nginx -d your-domain.com -d www.your-domain.com

# 自动续期配置
certbot renew --dry-run
```

**步骤4：启动服务**
```bash
# 启用站点
ln -s /etc/nginx/sites-available/research-center /etc/nginx/sites-enabled/

# 测试配置
nginx -t

# 重启Nginx
systemctl restart nginx

# 设置开机自启
systemctl enable nginx
```

#### 方案二：Docker容器化部署

**Dockerfile示例**
```dockerfile
# frontend/Dockerfile
FROM nginx:alpine
COPY build /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
```

**docker-compose.yml**
```yaml
version: '3.8'
services:
  frontend:
    build: ./frontend
    ports:
      - "80:80"
    restart: always
  
  backend:
    build: ./backend
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - DB_HOST=db
    depends_on:
      - db
  
  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=research_center
      - POSTGRES_USER=admin
      - POSTGRES_PASSWORD=secure_password
    volumes:
      - db_data:/var/lib/postgresql/data

volumes:
  db_data:
```

**部署命令**
```bash
# 构建并启动
docker-compose up -d

# 查看日志
docker-compose logs -f

# 停止服务
docker-compose down
```

### 2.3 静态网站托管方案

#### GitHub Pages（免费）
```bash
# 1. 创建GitHub仓库
# 2. 推送构建文件到gh-pages分支
git subtree push --prefix frontend/build origin gh-pages

# 3. 配置GitHub Pages
# Settings → Pages → Source: gh-pages branch
# 访问地址：https://[用户名].github.io/[仓库名]
```

#### Vercel（免费额度）
```bash
# 1. 安装Vercel CLI
npm i -g vercel

# 2. 部署
vercel --prod

# 3. 自动配置域名和SSL
```

#### 阿里云/腾讯云对象存储 + CDN
1. 创建存储桶，设置为静态网站托管
2. 上传`frontend/build`所有文件
3. 绑定自定义域名
4. 配置CDN加速和SSL证书

### 2.4 后端API部署

#### Node.js生产环境部署
```bash
# 1. 使用PM2进程管理
npm install -g pm2

# 2. 启动后端服务
cd backend
pm2 start src/server.js --name "research-center-api"

# 3. 设置开机自启
pm2 startup
pm2 save

# 4. 配置Nginx反向代理
# /etc/nginx/sites-available/api
server {
    listen 80;
    server_name api.your-domain.com;
    
    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 2.5 数据库部署

#### MySQL部署
```bash
# 1. 安装MySQL
apt install mysql-server -y

# 2. 安全配置
mysql_secure_installation

# 3. 创建数据库和用户
CREATE DATABASE research_center;
CREATE USER 'research_user'@'localhost' IDENTIFIED BY 'secure_password';
GRANT ALL PRIVILEGES ON research_center.* TO 'research_user'@'localhost';
FLUSH PRIVILEGES;
```

#### 数据库备份策略
```bash
# 每日自动备份
0 2 * * * mysqldump -u research_user -psecure_password research_center > /backup/research_center_$(date +\%Y\%m\%d).sql

# 保留最近30天备份
find /backup -name "*.sql" -mtime +30 -delete
```

## 第三部分：安全与维护

### 3.1 安全配置

#### 基础安全
```bash
# 1. 防火墙配置
ufw default deny incoming
ufw default allow outgoing
ufw allow ssh
ufw allow http
ufw allow https
ufw enable

# 2. 禁用root SSH登录
# /etc/ssh/sshd_config
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication yes

# 3. 定期更新
apt update && apt upgrade -y
```

#### Web安全
1. **HTTPS强制跳转**
   ```nginx
   # Nginx配置
   server {
       listen 80;
       server_name your-domain.com;
       return 301 https://$server_name$request_uri;
   }
   ```

2. **安全头设置**
   ```nginx
   add_header X-Frame-Options "SAMEORIGIN";
   add_header X-Content-Type-Options "nosniff";
   add_header X-XSS-Protection "1; mode=block";
   add_header Referrer-Policy "strict-origin-when-cross-origin";
   ```

### 3.2 监控与维护

#### 监控工具
```bash
# 1. 安装监控工具
apt install htop nmon net-tools -y

# 2. 日志监控
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# 3. 使用UptimeRobot监控网站可用性
# 免费计划：5分钟间隔，50个监控项
```

#### 备份策略
1. **网站文件备份**
   ```bash
   # 每日备份
   tar -czf /backup/website_$(date +\%Y\%m\%d).tar.gz /var/www/课题组网站
   ```

2. **数据库备份**（如前所述）

3. **配置文件备份**
   ```bash
   cp -r /etc/nginx/sites-available/ /backup/nginx-config/
   ```

### 3.3 性能优化

#### 前端优化
1. **图片优化**
   ```bash
   # 安装优化工具
   npm install -g imagemin-cli
   
   # 压缩图片
   imagemin frontend/src/assets/images/* --out-dir=frontend/build/static/images
   ```

2. **代码分割**
   ```javascript
   // React懒加载
   const Home = React.lazy(() => import('./pages/Home'));
   ```

#### 后端优化
1. **缓存策略**
   ```javascript
   // Express缓存中间件
   app.use(compression());
   app.use(helmet());
   ```

2. **数据库优化**
   ```sql
   -- 添加索引
   CREATE INDEX idx_papers_year ON academic_papers(publish_year);
   CREATE INDEX idx_projects_status ON research_projects(status);
   ```

## 第四部分：实施路线图

### 阶段一：内部完善（1-2周）
1. [ ] 替换所有示例数据为真实内容
2. [ ] 完善后端API基础功能
3. [ ] 内部测试和反馈收集
4. [ ] 培训课题组成员使用

### 阶段二：部署准备（1周）
1. [ ] 选择部署方案和服务器
2. [ ] 注册域名并备案
3. [ ] 准备部署脚本和配置
4. [ ] 数据迁移准备

### 阶段三：上线部署（1周）
1. [ ] 服务器环境搭建
2. [ ] 网站文件部署
3. [ ] 域名解析和SSL配置
4. [ ] 功能测试和性能测试

### 阶段四：运维优化（持续）
1. [ ] 监控系统设置
2. [ ] 定期备份机制
3. [ ] 安全更新和维护
4. [ ] 内容更新和功能扩展

## 第五部分：常见问题解决

### Q1: 网站无法在局域网访问
**解决方案**：
1. 检查防火墙设置
2. 确认服务器绑定到`0.0.0.0`而不是`127.0.0.1`
3. 检查路由器端口转发设置

### Q2: 部署后页面404错误
**解决方案**：
1. Nginx配置中添加`try_files`规则
2. 检查文件权限：`chmod -R 755 /var/www/课题组网站`
3. 确认构建文件完整上传

### Q3: 数据库连接失败
**解决方案**：
1. 检查数据库服务状态：`systemctl status mysql`
2. 验证连接信息：用户名、密码、主机名
3. 检查防火墙是否允许数据库端口

### Q4: SSL证书问题
**解决方案**：
1. 使用Certbot重新申请：`certbot renew --force-renewal`
2. 检查证书路径和权限
3. 验证域名解析是否正确

## 总结

您的课题组网站已经具备了良好的基础，可以立即在内部使用。对于外部部署，建议：

1. **短期方案**：使用静态托管服务（如GitHub Pages或Vercel）快速上线展示页面
2. **长期方案**：租用云服务器，采用Nginx + Docker的完整部署方案
3. **成本控制**：初期可选择按量付费的云服务器，根据访问量调整配置

建议先完成内部内容的完善和测试，然后根据实际需求选择合适的部署方案。网站的技术架构设计良好，具备良好的扩展性和维护性。

**下一步行动**：
1. 运行`启动网站/启动网站.bat`在内部测试
2. 更新页面中的示例内容
3. 选择并实施部署方案

如需具体的技术支持或部署协助，请参考项目文档或联系技术支持。
